(function(){var e,t,n,r,i,o,s,a,c,l,u,f,d,g,h,p,v,m;t=!1,u=function(){var e;return e=window.navigator.userAgent,e.indexOf("MSIE ")>0?!0:!1},c=function(){var e;return e=window.navigator.userAgent,e.indexOf("Chrome")>0?!0:!1},l=function(){var e;return e=window.navigator.userAgent,e.indexOf("Firefox")>0?!0:!1},h=function(e){var t,n,r,i;if(Array.isArray(e))return e;r=[];for(n in e)i=e[n],t={},t[n]=i,r.unshift(t);return r},r=function(e,t,n,i){var o;return o={},o.content=e,o.htmlfier=t,o.descriptor=h(n),o.klass=i,o.subnodes=[],o.supernode=null,o.processed=!1,o.terminate=!1,o.toHTML=function(){var t,n,r,i,s;if(o.processed||o.process(),i=this.klass?"<span class='"+this.klass+"'>":"",e="",this.terminate)e+=this.htmlfier(this.content);else for(s=this.subnodes,n=0,r=s.length;r>n;n++)o=s[n],e+=o.toHTML();return t=this.klass?"</span>":"",i+e+t},o.process=function(){var e,t,n,s,a,c,l,u,f,d,g;if(0===this.descriptor.length)this.terminate=!0;else{f=this.descriptor.pop();for(i in f){for(l=f[i],e=0,u=this.content;n=l.exec(u);)t=!0,d=u.substr(e,n.index),s=n[0],e=s.length+n.index,u=u.substr(e),e=0,d.length>0&&(g=r(d,this.htmlfier,this.descriptor.slice(0),null),this.subnodes.push(g)),a=r(s,this.htmlfier,this.descriptor.slice(0),i),this.subnodes.push(a);c=r(u,this.htmlfier,this.descriptor.slice(0),null),this.subnodes.push(c)}}return o.processed=!0},o},a=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/\//g,"&#x2F;"),e=e.replace(/\n/g,"<br>"),e=e.replace(new RegExp(" ","g"),"&nbsp;")},e=function(e,t,n,i){var o;return n||(n=a),o=r(e,n,t,i),o.toHTML()},o=function(t,n){return e(t,$.fn.colorfy[n],a,n)},s=function(e){return e=e.replace(/<(?!br|\/br).+?>/gm,""),e=e.replace(/<br>/g,"\n"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&amp;/g,"&"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&apos;/g,"'"),e=e.replace(/&#x2F/g,"/"),e=e.replace(/&nbsp;/g," ")},p=function(e){var t;for(t=[e];e=e.parentNode;)t.unshift(e);return t},n=function(e,t){var n,r,i,o,s;if(i=p(e),o=p(t),i[0]!==o[0])return null;for(n=r=0,s=i.length;s>r;n=r+=1)if(i[n]!==o[n])return i[n-1]},i=function(e,t,r,o){var s,a,c,l,u;if(o||(o=e),o===t)return d(t,r);if(!o.contains(t)&&e.contains(n(o,t))&&o.compareDocumentPosition(t)===Node.DOCUMENT_POSITION_FOLLOWING)return f(o);if(!o.contains(t)&&e.contains(n(o,t))&&o.compareDocumentPosition(t)===Node.DOCUMENT_POSITION_PRECEDING)return 0;if(o.contains(t)){for(l=0,u=o.childNodes,a=0,c=u.length;c>a;a++)s=u[a],l+=i(e,t,r,s);return l}},f=function(e){var t,n,r,i,o;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue.length;if("BR"===e.tagName)return 1;if("SPAN"===e.tagName||"DIV"===e.tagName){for(i=0,o=e.childNodes,n=0,r=o.length;r>n;n++)t=o[n],i+=f(t);return i}},d=function(e,t){var n,r,i,o;if(e.nodeType===Node.TEXT_NODE)return t;if("BR"===e.tagName)return console.log("Is this correct behavior?"),t;if("SPAN"===e.tagName||"DIV"===e.tagName){for(i=0,n=r=0,o=t;o>r;n=r+=1)i+=f(e.childNodes[n]);return i}},g=function(e,t){var n,r,i,o;if(f(t)<e)return[];if(t.nodeType===Node.TEXT_NODE)return[t,e];if("BR"===t.tagName)return c()?[t.nextSibling,0]:l()?"BR"===t.nextSibling.tagName?[t.nextSibling,0]:[t,0]:[t,e];for(o=t.childNodes,r=0,i=o.length;i>r;r++){if(n=o[r],!(f(n)<e))return g(e,n);e-=f(n)}},m=function(e){var t,n,r,o,s;return o=e[0],document.activeElement===o&&(s=window.getSelection(),s.isCollapsed&&(t=s.anchorNode,n=s.anchorOffset,o.contains(t)))?(r=i(o,t,n),e.data("cursorlocation",r)):void 0},v=function(e){var t,n,r,i,o;return r=e[0],document.activeElement===r&&(o=window.getSelection(),o.isCollapsed)?(i=g(e.data("cursorlocation"),r),t=i[0],n=i[1],t&&n>=0?o.collapse(t,n):void 0):void 0},$.fn.colorfy=function(e){return u()?void 0:this.each(function(){var n,r,i;return n=$(this),i=$("<div></div>"),i.attr("contenteditable","true"),i.attr("class",n.attr("class")),i.css("max-height",n.height()),i.css("height",n.height()),"input"===n.prop("tagName")?i.css("overflow","hidden"):i.css("overflow","scroll"),n.after(i),n.css("display","none"),r=n,r.on("keyup paste change input",function(e){return t||i.data("content",r.val()).trigger("receive-content"),t=!1}),i.on("receive-content",function(t){0===i.text().length?i.css("display","block"):i.css("display","inline-block"),i.html(o(i.data("content"),e)),v(i)}),i.on("send-content",function(e){return 0===i.text().length?i.css("display","block"):i.css("display","inline-block"),t=!0,r.val(i.data("content")).trigger("change")}),i.on("input paste",function(e){m(i),i.data("content",s(i.html())).trigger("send-content").trigger("receive-content")}),i.data("content",n.val()).trigger("receive-content")})}}).call(this);