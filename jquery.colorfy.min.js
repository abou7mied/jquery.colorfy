(function(){var e,t,n,r,i,o,s,a,c,l,u,f,d,h,g,p,v;l=function(){var e;return e=window.navigator.userAgent,e.indexOf("MSIE ")>0?!0:!1},a=function(){var e;return e=window.navigator.userAgent,e.indexOf("Chrome")>0?!0:!1},c=function(){var e;return e=window.navigator.userAgent,e.indexOf("Firefox")>0?!0:!1},h=function(e){var t,n,r,i;if(Array.isArray(e))return e;r=[];for(n in e)i=e[n],t={},t[n]=i,r.unshift(t);return r},n=function(e,t,r,i){var o;return o={},o.content=e,o.htmlfier=t,o.descriptor=h(r),o.klass=i,o.subnodes=[],o.supernode=null,o.processed=!1,o.terminate=!1,o.toHTML=function(){var t,n,r,i,s;if(o.processed||o.process(),i=this.klass?"<span class='"+this.klass+"'>":"",e="",this.terminate)e+=this.htmlfier(this.content);else for(s=this.subnodes,n=0,r=s.length;r>n;n++)o=s[n],e+=o.toHTML();return t=this.klass?"</span>":"",i+e+t},o.process=function(){var e,t,r,s,a,c,l,u,f,d,h;if(0===this.descriptor.length)this.terminate=!0;else{f=this.descriptor.pop();for(i in f){for(l=f[i],e=0,u=this.content;r=l.exec(u);)t=!0,d=u.substr(e,r.index),s=r[0],e=s.length+r.index,u=u.substr(e),e=0,d.length>0&&(h=n(d,this.htmlfier,this.descriptor.slice(0),null),this.subnodes.push(h)),a=n(s,this.htmlfier,this.descriptor.slice(0),i),this.subnodes.push(a);c=n(u,this.htmlfier,this.descriptor.slice(0),null),this.subnodes.push(c)}}return o.processed=!0},o},s=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/\//g,"&#x2F;"),e=e.replace(/\n/g,"<br>"),e=e.replace(new RegExp(" ","g"),"&nbsp;")},e=function(e,t,r,i){var o;return r||(r=s),o=n(e,r,t,i),o.toHTML()},i=function(t,n){return e(t,$.fn.colorfy[n],s,n)},o=function(e){return e=e.replace(/<(?!br|\/br).+?>/gm,""),e=e.replace(/<br>/g,"\n"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&amp;/g,"&"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&apos;/g,"'"),e=e.replace(/&#x2F/g,"/"),e=e.replace(/&nbsp;/g," ")},g=function(e){var t;for(t=[e];e=e.parentNode;)t.unshift(e);return t},t=function(e,t){var n,r,i,o,s;if(i=g(e),o=g(t),i[0]!==o[0])return null;for(n=r=0,s=i.length;s>r;n=r+=1)if(i[n]!==o[n])return i[n-1]},r=function(e,n,i,o){var s,a,c,l,d;if(o||(o=e),o===n)return f(n,i);if(!o.contains(n)&&e.contains(t(o,n))&&o.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_FOLLOWING)return u(o);if(!o.contains(n)&&e.contains(t(o,n))&&o.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_PRECEDING)return 0;if(o.contains(n)){for(l=0,d=o.childNodes,a=0,c=d.length;c>a;a++)s=d[a],l+=r(e,n,i,s);return l}},u=function(e){var t,n,r,i,o;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue.length;if("BR"===e.tagName)return 1;if("SPAN"===e.tagName||"DIV"===e.tagName){for(i=0,o=e.childNodes,n=0,r=o.length;r>n;n++)t=o[n],i+=u(t);return i}},f=function(e,t){var n,r,i,o;if(e.nodeType===Node.TEXT_NODE)return t;if("BR"===e.tagName)return console.log("Is this correct behavior?"),t;if("SPAN"===e.tagName||"DIV"===e.tagName){for(i=0,n=r=0,o=t;o>r;n=r+=1)i+=u(e.childNodes[n]);return i}},d=function(e,t){var n,r,i,o;if(u(t)<e)return[];if(t.nodeType===Node.TEXT_NODE)return[t,e];if("BR"===t.tagName)return a()?[t.nextSibling,0]:c()?"BR"===t.nextSibling.tagName?[t.nextSibling,0]:[t,0]:[t,e];for(o=t.childNodes,r=0,i=o.length;i>r;r++){if(n=o[r],!(u(n)<e))return d(e,n);e-=u(n)}},v=function(e){var t,n,i,o,s;return o=e[0],document.activeElement===o&&(s=window.getSelection(),s.isCollapsed&&(t=s.anchorNode,n=s.anchorOffset,o.contains(t)))?(i=r(o,t,n),e.data("cursorlocation",i)):void 0},p=function(e){var t,n,r,i,o;return r=e[0],document.activeElement===r&&(o=window.getSelection(),o.isCollapsed)?(i=d(e.data("cursorlocation"),r),t=i[0],n=i[1],t&&n>=0?o.collapse(t,n):void 0):void 0},$.fn.colorfy=function(e){return l()?void 0:this.each(function(){var t,n,r;return t=$(this),r=$("<div></div>"),r.attr("contenteditable","true"),r.attr("class",t.attr("class")),r.css("max-height",t.height()),r.css("height",t.height()),"input"===t.prop("tagName")?r.css("overflow","hidden"):r.css("overflow","scroll"),t.after(r),t.css("display","none"),n=t,n.on("keyup paste change",function(e){return r.data("content",n.val()).trigger("receive-content")}),r.on("receive-content",function(t){0===r.text().length?r.css("display","block"):r.css("display","inline-block"),r.html(i(r.data("content"),e)),p(r)}),r.on("send-content",function(e){return 0===r.text().length?r.css("display","block"):r.css("display","inline-block"),n.val(r.data("content"))}),r.on("input paste",function(e){v(r),r.data("content",o(r.html())).trigger("send-content").trigger("receive-content")}),r.data("content",t.val()).trigger("receive-content")})}}).call(this);